<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DC2 Image Analysis, 511 keV, Image Deconvolution using CDS in the Galactic coordinate system &mdash; cosipy __version__ = &#34;0.2.1&#34;
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=0aed9c3d"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            cosipy
              <img src="../../../../_static/cosipy_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other_examples.html">Other examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">cosipy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DC2 Image Analysis, 511 keV, Image Deconvolution using CDS in the Galactic coordinate system</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/tutorials/image_deconvolution/511keV/GalacticCDS/511keV-DC2-Galactic-ImageDeconvolution.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="DC2-Image-Analysis,-511-keV,-Image-Deconvolution-using-CDS-in-the-Galactic-coordinate-system">
<h1>DC2 Image Analysis, 511 keV, Image Deconvolution using CDS in the Galactic coordinate system<a class="headerlink" href="#DC2-Image-Analysis,-511-keV,-Image-Deconvolution-using-CDS-in-the-Galactic-coordinate-system" title="Link to this heading"></a></h1>
<p>updated on 2024-02-22 (the commit f27cd0bee26c56a93d34a06f2c0af88cb1f59f6e)</p>
<p>This notebook focuses on the image deconvolution with the Compton data space (CDS) in the Galactic coordinate system. An example of the image analysis will be presented using the 511keV thin disk 3-month simulation data created for DC2.</p>
<p>In DC2, we have two options on the coordinate system to describe the Compton scattering direction (<span class="math notranslate nohighlight">\(\chi\psi\)</span>) in the image deconvolution. Please also check the notes written in 511keV-DC2-ScAtt-DataReduction.ipynb.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from histpy import Histogram, HealpixAxis, Axis, Axes
from mhealpy import HealpixMap
from astropy.coordinates import SkyCoord, cartesian_to_spherical, Galactic

from cosipy.response import FullDetectorResponse
from cosipy.spacecraftfile import SpacecraftFile
from cosipy.ts_map.TSMap import TSMap
from cosipy.data_io import UnBinnedData, BinnedData
from cosipy.image_deconvolution import SpacecraftAttitudeExposureTable, CoordsysConversionMatrix, DataLoader, ImageDeconvolution
from cosipy.util import fetch_wasabi_file

# cosipy uses astropy units
import astropy.units as u
from astropy.units import Quantity
from astropy.coordinates import SkyCoord
from astropy.time import Time
from astropy.table import Table
from astropy.io import fits
from scoords import Attitude, SpacecraftFrame

#3ML is needed for spectral modeling
from threeML import *
from astromodels import Band

#Other standard libraries
import os
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.gridspec import GridSpec

import healpy as hp
from tqdm.autonotebook import tqdm

%matplotlib inline
</pre></div>
</div>
</div>
</section>
<section id="0.-Files-needed-for-this-notebook">
<h1>0. Files needed for this notebook<a class="headerlink" href="#0.-Files-needed-for-this-notebook" title="Link to this heading"></a></h1>
<p>From wasabi - cosi-pipeline-public/COSI-SMEX/DC2/Responses/PointSourceReponse/psr_gal_511_DC2.h5.gz (please gunzip it) - a pre-computed 511 keV line response file converted into the Galactic coordinate system - cosi-pipeline-public/COSI-SMEX/DC2/Data/Sources/511_thin_disk_3months_unbinned_data.fits.gz - cosi-pipeline-public/COSI-SMEX/DC2/Data/Backgrounds/albedo_photons_3months_unbinned_data.fits.gz - In this notebook, only the albedo gamma-ray background is considered for a tutorial. - If you
want to consider all of the background components, please replace it with cosi-pipeline-public/COSI-SMEX/DC2/Data/Backgrounds/total_bg_3months_unbinned_data.fits.gz - Note that total_bg_3months_unbinned_data.fits.gz is 14.15 GB.</p>
<p>From docs/tutorials/image_deconvolution/511keV/GalacticCDS - inputs_511keV_DC2.yaml - imagedeconvolution_parfile_gal_511keV.yml</p>
<p>You can download the data and detector response from wasabi. You can skip this cell if you already have downloaded the files.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Response file:
# wasabi path: COSI-SMEX/DC2/Responses/PointSourceReponse/psr_gal_511_DC2.h5.gz
# File size: 3.82 GB
fetch_wasabi_file(&#39;COSI-SMEX/DC2/Responses/PointSourceReponse/psr_gal_511_DC2.h5.gz&#39;)
os.system(&#39;gunzip psr_gal_511_DC2.h5.gz&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Source file (511 keV thin disk model):
# wasabi path: COSI-SMEX/DC2/Data/Sources/511_thin_disk_3months_unbinned_data.fits.gz
# File size: 202.45 MB
fetch_wasabi_file(&#39;COSI-SMEX/DC2/Data/Sources/511_thin_disk_3months_unbinned_data.fits.gz&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Background file (albedo gamma):
# wasabi path: COSI-SMEX/DC2/Data/Backgrounds/albedo_photons_3months_unbinned_data.fits.gz
# File size: 2.69 GB
fetch_wasabi_file(&#39;COSI-SMEX/DC2/Data/Backgrounds/albedo_photons_3months_unbinned_data.fits.gz&#39;)
</pre></div>
</div>
</div>
</section>
<section id="1.-Create-binned-event/background-files-in-the-Galactic-coordinate-system">
<h1>1. Create binned event/background files in the Galactic coordinate system<a class="headerlink" href="#1.-Create-binned-event/background-files-in-the-Galactic-coordinate-system" title="Link to this heading"></a></h1>
<p>please modify “path_data” corresponding to your environment.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>path_data = &quot;path/to/data/&quot;
</pre></div>
</div>
</div>
<p><strong>Source</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time

signal_filepath = path_data + &quot;511_thin_disk_3months_unbinned_data.fits.gz&quot;

binned_signal = BinnedData(input_yaml = &quot;inputs_511keV_DC2.yaml&quot;)

binned_signal.get_binned_data(unbinned_data = signal_filepath, psichi_binning=&quot;galactic&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
binning data...
Time unit: s
Em unit: keV
Phi unit: deg
PsiChi unit: None
CPU times: user 7.75 s, sys: 255 ms, total: 8 s
Wall time: 8.06 s
</pre></div></div>
</div>
<p><strong>Background</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time

bkg_filepath = path_data + &quot;albedo_photons_3months_unbinned_data.fits.gz&quot;

binned_bkg = BinnedData(input_yaml = &quot;inputs_511keV_DC2.yaml&quot;)

binned_bkg.get_binned_data(unbinned_data = bkg_filepath, psichi_binning=&quot;galactic&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
binning data...
Time unit: s
Em unit: keV
Phi unit: deg
PsiChi unit: None
CPU times: user 1min 51s, sys: 3.96 s, total: 1min 55s
Wall time: 1min 55s
</pre></div></div>
</div>
<p>Convert the data into sparse matrices &amp; add the signal to the background</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>signal = binned_signal.binned_data.to_dense()
bkg = binned_bkg.binned_data.to_dense()
event = signal + bkg
</pre></div>
</div>
</div>
<p>Save the binned histograms</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>signal.write(&quot;511keV_dc2_galactic_signal.hdf5&quot;, overwrite = True)
bkg.write(&quot;511keV_dc2_galactic_bkg.hdf5&quot;, overwrite = True)
event.write(&quot;511keV_dc2_galactic_event.hdf5&quot;, overwrite = True)
</pre></div>
</div>
</div>
<p>Load the saved files</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>signal = Histogram.open(&quot;511keV_dc2_galactic_signal.hdf5&quot;)
bkg = Histogram.open(&quot;511keV_dc2_galactic_bkg.hdf5&quot;)
event = Histogram.open(&quot;511keV_dc2_galactic_event.hdf5&quot;)
</pre></div>
</div>
</div>
<p>In DC2, the number of time bins should be 1 when you perform the image deconvolution using the galactic CDS. It is because the pre-computed response files in the galactic coordinate have no time axis, and all of the events are assumed to be projected into a single galactic CDS. In the future, we plan to introduce more flexible binning.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bkg.axes[&#39;Time&#39;].edges
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$[1.8354873 \times 10^{9},~1.8434673 \times 10^{9}] \; \mathrm{s}$</div></div>
</div>
</section>
<section id="2.-Load-the-response-matrix">
<h1>2. Load the response matrix<a class="headerlink" href="#2.-Load-the-response-matrix" title="Link to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time

response_path = path_data + &quot;psr_gal_511_DC2.h5&quot;

image_response = Histogram.open(response_path)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 3.61 s, sys: 25.7 s, total: 29.3 s
Wall time: 47.9 s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image_response.axes.labels
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;NuLambda&#39;, &#39;Ei&#39;, &#39;Em&#39;, &#39;Phi&#39;, &#39;PsiChi&#39;], dtype=&#39;&lt;U8&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image_response.contents.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3072, 1, 1, 60, 3072)
</pre></div></div>
</div>
</section>
<section id="3.-Prepare-a-'fake'-coordsys-conversion-matrix">
<h1>3. Prepare a ‘fake’ coordsys conversion matrix<a class="headerlink" href="#3.-Prepare-a-'fake'-coordsys-conversion-matrix" title="Link to this heading"></a></h1>
<p>The coordsys conversion matrix was initially introduced to convert a model map in the Galactic coordinates into the local coordinates. In the case of this notebook, the CDS is in the Galactic coordinates; thus, ideally, we do not have to convert the coordinates of the model map. However, as for now, the code for the image deconvolution was mainly developed for the CDS in the local coordinates and requires the conversion matrix, so here, we generate a ‘fake’ coordinate conversion matrix, which is
an unit matrix. Then, the same code can be applied for both methods. We will consider removing this fake coordinate conversion matrix in the future.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>nside = image_response.axes[&#39;NuLambda&#39;].nside
nside
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>axes = [event.axes[&#39;Time&#39;],
        HealpixAxis(nside = nside, coordsys = &quot;galactic&quot;, label = &quot;lb&quot;),
        HealpixAxis(nside = nside, coordsys = &quot;galactic&quot;, label = &quot;NuLambda&quot;)]

ccm = CoordsysConversionMatrix(axes, binning_method = &#39;Time&#39;, unit = u.dimensionless_unscaled, sparse = True)

for ipix in range(axes[1].npix):
    ccm[:,ipix,ipix] = 1 * u.dimensionless_unscaled
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ccm.contents
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table><tbody><tr><th style="text-align: left">Format</th><td style="text-align: left">coo</td></tr><tr><th style="text-align: left">Data Type</th><td style="text-align: left">float64</td></tr><tr><th style="text-align: left">Shape</th><td style="text-align: left">(1, 3072, 3072)</td></tr><tr><th style="text-align: left">nnz</th><td style="text-align: left">3072</td></tr><tr><th style="text-align: left">Density</th><td style="text-align: left">0.0003255208333333333</td></tr><tr><th style="text-align: left">Read-only</th><td style="text-align: left">True</td></tr><tr><th style="text-align: left">Size</th><td style="text-align: left">96.0K</td></tr><tr><th style="text-align: left">Storage ratio</th><td style="text-align: left">0.0</td></tr></tbody></table></div>
</div>
</section>
<section id="4.-Imaging-deconvolution">
<h1>4. Imaging deconvolution<a class="headerlink" href="#4.-Imaging-deconvolution" title="Link to this heading"></a></h1>
<section id="Brief-overview-of-the-image-deconvolution">
<h2>Brief overview of the image deconvolution<a class="headerlink" href="#Brief-overview-of-the-image-deconvolution" title="Link to this heading"></a></h2>
<p>Basically, we have to maximize the following likelihood function</p>
<div class="math notranslate nohighlight">
\[\log L = \sum_i X_i \log \epsilon_i - \sum_i \epsilon_i\]</div>
<p><span class="math notranslate nohighlight">\(X_i\)</span>: detected counts at <span class="math notranslate nohighlight">\(i\)</span>-th bin ( <span class="math notranslate nohighlight">\(i\)</span> : index of the Compton Data Space)</p>
<p><span class="math notranslate nohighlight">\(\epsilon_i = \sum_j R_{ij} \lambda_j + b_i\)</span> : expected counts ( <span class="math notranslate nohighlight">\(j\)</span> : index of the model space)</p>
<p><span class="math notranslate nohighlight">\(\lambda_j\)</span> : the model map (basically gamma-ray flux at <span class="math notranslate nohighlight">\(j\)</span>-th pixel)</p>
<p><span class="math notranslate nohighlight">\(b_i\)</span> : the background at <span class="math notranslate nohighlight">\(i\)</span>-th bin</p>
<p><span class="math notranslate nohighlight">\(R_{ij}\)</span> : the response matrix</p>
<p>Since we have to optimize the flux in each pixel, and the number of parameters is large, we adopt an iterative approach to find a solution of the above equation. The simplest one is the ML-EM (Maximum Likelihood Expectation Maximization) algorithm. It is also known as the Richardson-Lucy algorithm.</p>
<div class="math notranslate nohighlight">
\[\lambda_{j}^{k+1} = \lambda_{j}^{k} + \delta \lambda_{j}^{k}\]</div>
<div class="math notranslate nohighlight">
\[\delta \lambda_{j}^{k} = \frac{\lambda_{j}^{k}}{\sum_{i} R_{ij}} \sum_{i} \left(\frac{ X_{i} }{\epsilon_{i}} - 1 \right) R_{ij}\]</div>
<p>We refer to <span class="math notranslate nohighlight">\(\delta \lambda_{j}^{k}\)</span> as the delta map.</p>
<p>As for now, the two improved algorithms are implemented in COSIpy.</p>
<ul class="simple">
<li><p>Accelerated ML-EM algorithm (Knoedlseder+99)</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\lambda_{j}^{k+1} = \lambda_{j}^{k} + \alpha^{k} \delta \lambda_{j}^{k}\]</div>
<div class="math notranslate nohighlight">
\[\alpha^{k} &lt; \mathrm{max}(- \lambda_{j}^{k} / \delta \lambda_{j}^{k})\]</div>
<p>Practically, in order not to accelerate the algorithm excessively, we set the maximum value of <span class="math notranslate nohighlight">\(\alpha\)</span> (<span class="math notranslate nohighlight">\(\alpha_{\mathrm{max}}\)</span>). Then, <span class="math notranslate nohighlight">\(\alpha\)</span> is calculated as:</p>
<div class="math notranslate nohighlight">
\[\alpha^{k} = \mathrm{min}(\mathrm{max}(- \lambda_{j}^{k} / \delta \lambda_{j}^{k}), \alpha_{\mathrm{max}})\]</div>
<ul class="simple">
<li><p>Noise damping using gaussian smoothing (Knoedlseder+05, Siegert+20)</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\lambda_{j}^{k+1} = \lambda_{j}^{k} + \alpha^{k} \left[ w_j \delta \lambda_{j}^{k} \right]_{\mathrm{gauss}}\]</div>
<div class="math notranslate nohighlight">
\[w_j = \left(\sum_{i} R_{ij}\right)^\beta\]</div>
<p><span class="math notranslate nohighlight">\(\left[ ... \right]_{\mathrm{gauss}}\)</span> means that the differential image is smoothed by a gaussian filter.</p>
</section>
<section id="4-1.-Prepare-DataLoader-containing-all-neccesary-datasets">
<h2>4-1. Prepare DataLoader containing all neccesary datasets<a class="headerlink" href="#4-1.-Prepare-DataLoader-containing-all-neccesary-datasets" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataloader = DataLoader()

dataloader.event_dense = event
dataloader.bkg_dense = bkg

# the loaded response matrix should be assigned to both full_detector_response/image_response_dense in the Galactic CDS method.
dataloader.full_detector_response = image_response
dataloader.image_response_dense = image_response

dataloader.response_on_memory = True
dataloader.coordsys_conv_matrix = ccm
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataloader._modify_axes()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... checking the axis Time of the event and background files...
    --&gt; pass (edges)
    --&gt; pass (unit)
... checking the axis Em of the event and background files...
    --&gt; pass (edges)
    --&gt; pass (unit)
... checking the axis Phi of the event and background files...
    --&gt; pass (edges)
    --&gt; pass (unit)
... checking the axis PsiChi of the event and background files...
    --&gt; pass (edges)
    --&gt; pass (unit)
...checking the axis Em of the event and response files...
    --&gt; pass (edges)
...checking the axis Phi of the event and response files...
    --&gt; pass (edges)
...checking the axis PsiChi of the event and response files...
    --&gt; pass (edges)
The axes in the event and background files are redefined. Now they are consistent with those of the response file.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

WARNING FutureWarning: Note that _modify_axes() in DataLoader was implemented for a temporary use. It will be removed in the future.


WARNING UserWarning: Make sure to perform _modify_axes() only once after the data are loaded.

</pre></div></div>
</div>
<p>(In the future, we plan to remove the method “_modify_axes.”)</p>
<p>Here, we calculate an auxiliary matrix for the deconvolution. Basically, it is a response matrix projected into the model space (<span class="math notranslate nohighlight">\(\sum_{i} R_{ij}\)</span>). Currently, it is mandatory to run this command for the image deconvolution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time

dataloader.calc_image_response_projected()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... (DataLoader) calculating a projected image response ...
CPU times: user 395 ms, sys: 340 ms, total: 735 ms
Wall time: 735 ms
</pre></div></div>
</div>
</section>
<section id="4-3.-Initialize-the-instance-of-the-image-deconvolution-class">
<h2>4-3. Initialize the instance of the image deconvolution class<a class="headerlink" href="#4-3.-Initialize-the-instance-of-the-image-deconvolution-class" title="Link to this heading"></a></h2>
<p>First, we prepare an instance of the ImageDeconvolution class and then register the dataset and parameters for the deconvolution. After that, you can start the calculation.</p>
<p>please modify this parameter_filepath corresponding to your environment.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>parameter_filepath = &quot;imagedeconvolution_parfile_gal_511keV.yml&quot;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image_deconvolution = ImageDeconvolution()

# set dataloader to image_deconvolution
image_deconvolution.set_data(dataloader)

# set a parameter file for the image deconvolution
image_deconvolution.read_parameterfile(parameter_filepath)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
data for image deconvolution was set -&gt;  &lt;cosipy.image_deconvolution.data_loader.DataLoader object at 0x2f41b8280&gt;
parameter file for image deconvolution was set -&gt;  imagedeconvolution_parfile_gal_511keV.yml
</pre></div></div>
</div>
<section id="Initialize-image_deconvolution">
<h3>Initialize image_deconvolution<a class="headerlink" href="#Initialize-image_deconvolution" title="Link to this heading"></a></h3>
<p>In this process, a model map is defined following the input parameters, and it is initialized. Also, it prepares ancillary data for the image deconvolution, e.g., the expected counts with the initial model map, gaussian smoothing filter etc.</p>
<p>I describe parameters in the parameter file.</p>
<section id="model_property">
<h4>model_property<a class="headerlink" href="#model_property" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>coordinate</p></td>
<td><p>str</p></td>
<td><p>the coordinate system of the model map</p></td>
<td><p>As for now, it must be ‘galactic’</p></td>
</tr>
<tr class="row-odd"><td><p>nside</p></td>
<td><p>int</p></td>
<td><p>NSIDE of the model map</p></td>
<td><p>it must be the same as NSIDE of ‘lb’ axis of the coordinate conversion matrix</p></td>
</tr>
<tr class="row-even"><td><p>scheme</p></td>
<td><p>str</p></td>
<td><p>SCHEME of the model map</p></td>
<td><p>As for now, it must be ‘ring’</p></td>
</tr>
<tr class="row-odd"><td><p>energy_edges</p></td>
<td><p>list of float [keV]</p></td>
<td><p>The definition of the energy bins of the model map</p></td>
<td><p>As for now, it must be the same as that of the response matrix</p></td>
</tr>
</tbody>
</table>
</section>
<section id="model_initialization">
<h4>model_initialization<a class="headerlink" href="#model_initialization" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>algorithm</p></td>
<td><p>str</p></td>
<td><p>the method name to initialize the model map</p></td>
<td><p>As for now, only ‘flat’ can be used</p></td>
</tr>
<tr class="row-odd"><td><p>parameter_flat:values</p></td>
<td><p>list of float [cm-2 s-1 sr-1]</p></td>
<td><p>the list of photon fluxes for each energy band</p></td>
<td><p>the length of the list should be the same as the length of “energy_edges” - 1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="deconvolution">
<h4>deconvolution<a class="headerlink" href="#deconvolution" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>algorithm</p></td>
<td><p>str</p></td>
<td><p>the name of the image deconvolution algorithm</p></td>
<td><p>As for now, only ‘RL’ is supported</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>parameter_RL:iteration</p></td>
<td><p>int</p></td>
<td><p>The maximum number of the iteration</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>parameter_RL:acceleration</p></td>
<td><p>bool</p></td>
<td><p>whether the accelerated ML-EM algorithm (Knoedlseder+99) is used</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>parameter_RL:alpha_max</p></td>
<td><p>float</p></td>
<td><p>the maximum value for the acceleration parameter</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>parameter_RL:save_results_each_iteration</p></td>
<td><p>bool</p></td>
<td><p>whether an updated model map, detal map, likelihood etc. are saved at the end of each iteration</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>parameter_RL:response_weighting</p></td>
<td><p>bool</p></td>
<td><p>whether a delta map is renormalized based on the exposure time on each pixel, namely
<span class="math notranslate nohighlight">\(w_j = (\sum_{i} R_{ij})^{\beta}\)</span> (see Knoedlseder+05, Siegert+20)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>parameter_RL:response_weighting_index</p></td>
<td><p>float</p></td>
<td><p><span class="math notranslate nohighlight">\(\beta\)</span> in the above equation</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>parameter_RL:smoothing</p></td>
<td><p>bool</p></td>
<td><p>whether a Gaussian filter is used (see Knoedlseder+05, Siegert+20)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>parameter_RL:smoothing_FWHM</p></td>
<td><p>float, degree</p></td>
<td><p>the FWHM of the Gaussian in the filter</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>parameter_RL:background_normalization_fitting</p></td>
<td><p>bool</p></td>
<td><p>whether the background normalization factor is optimized at each iteration</p></td>
<td><p>As for now, the single background normalization factor is used in all of the bins</p></td>
</tr>
<tr class="row-odd"><td><p>parameter_RL:background_normalization_range</p></td>
<td><p>list of float</p></td>
<td><p>the range of the normalization factor</p></td>
<td><p>should be positive</p></td>
</tr>
</tbody>
</table>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image_deconvolution.initialize()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#### Initialization ####
1. generating a model map
---- parameters ----
coordinate: galactic
energy_edges:
- 509.0
- 513.0
nside: 16
scheme: ring

2. initializing the model map ...
---- parameters ----
algorithm: flat
parameter_flat:
  values:
  - 1e-4

3. registering the deconvolution algorithm ...
... calculating the expected events with the initial model map ...
... calculating the response weighting filter...
... calculating the gaussian filter...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f867026503df4ec38a7742788ff48203", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---- parameters ----
algorithm: RL
parameter_RL:
  acceleration: true
  alpha_max: 10.0
  background_normalization_fitting: false
  background_normalization_range:
  - 0.01
  - 10.0
  iteration: 10
  response_weighting: true
  response_weighting_index: 0.5
  save_results_each_iteration: false
  smoothing: true
  smoothing_FWHM: 2.0
  smoothing_max_sigma: 10.0

#### Done ####

</pre></div></div>
</div>
</section>
</section>
<section id="(You-can-change-the-parameters-as-follows)">
<h3>(You can change the parameters as follows)<a class="headerlink" href="#(You-can-change-the-parameters-as-follows)" title="Link to this heading"></a></h3>
<p>Note that when you modify the parameters, do not forget to run “initialize” again!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>image_deconvolution.override_parameter(&quot;deconvolution:parameter_RL:iteration = 50&quot;)
image_deconvolution.override_parameter(&quot;deconvolution:parameter_RL:background_normalization_fitting = True&quot;)
image_deconvolution.override_parameter(&quot;deconvolution:parameter_RL:alpha_max = 5.0&quot;)
image_deconvolution.override_parameter(&quot;deconvolution:parameter_RL:smoothing_FWHM = 3.0&quot;)
image_deconvolution.override_parameter(&quot;deconvolution:parameter_RL:response_weighting = False&quot;)

image_deconvolution.initialize()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#### Initialization ####
1. generating a model map
---- parameters ----
coordinate: galactic
energy_edges:
- 509.0
- 513.0
nside: 16
scheme: ring

2. initializing the model map ...
---- parameters ----
algorithm: flat
parameter_flat:
  values:
  - 1e-4

3. registering the deconvolution algorithm ...
... calculating the expected events with the initial model map ...
... calculating the gaussian filter...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7c032f939ff743e3aed4c0687771765b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---- parameters ----
algorithm: RL
parameter_RL:
  acceleration: true
  alpha_max: 5.0
  background_normalization_fitting: true
  background_normalization_range:
  - 0.01
  - 10.0
  iteration: 50
  response_weighting: false
  response_weighting_index: 0.5
  save_results_each_iteration: false
  smoothing: true
  smoothing_FWHM: 3.0
  smoothing_max_sigma: 10.0

#### Done ####

</pre></div></div>
</div>
</section>
</section>
<section id="4-5.-Start-the-image-deconvolution">
<h2>4-5. Start the image deconvolution<a class="headerlink" href="#4-5.-Start-the-image-deconvolution" title="Link to this heading"></a></h2>
<p><strong>With MacBook Pro with M1 Max and 64 GB memory, it takes about 1.5 minutes for 50 iterations.</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time

all_results = image_deconvolution.run_deconvolution()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#### Deconvolution Starts ####
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "123a41b5298c4d5eba8c9cf62c8c5b76", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Iteration 1/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

WARNING RuntimeWarning: invalid value encountered in divide

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 386050.327946638
    background_normalization: 1.1900860583584663
  Iteration 2/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 400418.0610733818
    background_normalization: 1.1604351059838505
  Iteration 3/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 411089.6070768463
    background_normalization: 1.0528532374315778
  Iteration 4/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 412844.82476469607
    background_normalization: 1.0586383806179276
  Iteration 5/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 405718.57862391905
    background_normalization: 0.9646219744282969
  Iteration 6/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 415983.925941571
    background_normalization: 1.1066673898750912
  Iteration 7/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 416858.4161653833
    background_normalization: 1.0806318578055656
  Iteration 8/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 414257.0394215712
    background_normalization: 1.0102344432919617
  Iteration 9/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 417764.7103005161
    background_normalization: 1.0821152684078852
  Iteration 10/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 418085.83036392974
    background_normalization: 1.0628439330942752
  Iteration 11/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 416671.5483449631
    background_normalization: 1.01071378053145
  Iteration 12/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 418586.7202159421
    background_normalization: 1.06125861498167
  Iteration 13/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 418748.2154258507
    background_normalization: 1.046438809261912
  Iteration 14/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 417929.9387790803
    background_normalization: 1.0064089218442853
  Iteration 15/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419053.901413677
    background_normalization: 1.044315278190893
  Iteration 16/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419142.6261917602
    background_normalization: 1.032928348339306
  Iteration 17/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 418668.7303367079
    background_normalization: 1.0022726458324056
  Iteration 18/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419331.81249085104
    background_normalization: 1.0310819169451524
  Iteration 19/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419384.6657808487
    background_normalization: 1.022400747988371
  Iteration 20/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419117.17787774315
    background_normalization: 0.9990969032872745
  Iteration 21/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419503.1781891738
    background_normalization: 1.020903831468017
  Iteration 22/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419537.4338580138
    background_normalization: 1.0143336117743598
  Iteration 23/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419391.0999065008
    background_normalization: 0.996731360121657
  Iteration 24/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419612.81397406233
    background_normalization: 1.0131337570188672
  Iteration 25/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419636.6847504409
    background_normalization: 1.0081895689199645
  Iteration 26/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419559.4179241776
    background_normalization: 0.9949613976847363
  Iteration 27/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419685.6098920044
    background_normalization: 1.007241126899907
  Iteration 28/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419703.1797833361
    background_normalization: 1.0035377514781483
  Iteration 29/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419664.32482954196
    background_normalization: 0.9936399908743172
  Iteration 30/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419487.46208422736
    background_normalization: 1.0028055191196619
  Iteration 31/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 418669.1558819624
    background_normalization: 0.9799331479447816
  Iteration 32/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419634.10911400197
    background_normalization: 1.0211029605768254
  Iteration 33/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419659.03221757046
    background_normalization: 1.0136432733397405
  Iteration 34/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419411.490253184
    background_normalization: 0.9943973775742112
  Iteration 35/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419725.5587795917
    background_normalization: 1.015325684269482
  Iteration 36/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419738.1626685151
    background_normalization: 1.0099456346378402
  Iteration 37/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419626.3826360004
    background_normalization: 0.9957165764734817
  Iteration 38/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419778.6108548996
    background_normalization: 1.009612147376651
  Iteration 39/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419787.8858903183
    background_normalization: 1.0056281285483295
  Iteration 40/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419731.6003448446
    background_normalization: 0.9950185424057802
  Iteration 41/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419813.53259433387
    background_normalization: 1.0050135239487987
  Iteration 42/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419820.6780524987
    background_normalization: 1.002046819706305
  Iteration 43/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419792.0089048097
    background_normalization: 0.9941334048497183
  Iteration 44/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419672.64219748904
    background_normalization: 1.001496431493074
  Iteration 45/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419151.89420566417
    background_normalization: 0.9830572014967464
  Iteration 46/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419768.8962983411
    background_normalization: 1.0159118239103546
  Iteration 47/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419781.17991715414
    background_normalization: 1.0099829791967136
  Iteration 48/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419623.7705518758
    background_normalization: 0.994708877170725
  Iteration 49/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; continue
--&gt; registering results
--&gt; showing results
    alpha: 1.0
    loglikelihood: 419821.7835588583
    background_normalization: 1.0112793627463252
  Iteration 50/50
--&gt; pre-processing
--&gt; E-step
... skip E-step ...
--&gt; M-step
--&gt; post-processing
... calculating the expected events with the updated model map ...
--&gt; checking stopping criteria
--&gt; --&gt; stop
--&gt; registering results
--&gt; showing results
    alpha: 5.0
    loglikelihood: 419827.8357267488
    background_normalization: 1.0070105323513425
#### Done ####

CPU times: user 3min 26s, sys: 2min 3s, total: 5min 30s
Wall time: 1min 25s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pprint

pprint.pprint(all_results)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.1900860583584663,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2babfa860&gt;,
  &#39;iteration&#39;: 1,
  &#39;loglikelihood&#39;: 386050.327946638,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2babf8040&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2edeee560&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.1604351059838505,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2ee501db0&gt;,
  &#39;iteration&#39;: 2,
  &#39;loglikelihood&#39;: 400418.0610733818,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62560&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2ee501ea0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0528532374315778,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2f41a6440&gt;,
  &#39;iteration&#39;: 3,
  &#39;loglikelihood&#39;: 411089.6070768463,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61180&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2f41a4b20&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0586383806179276,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2efc4df30&gt;,
  &#39;iteration&#39;: 4,
  &#39;loglikelihood&#39;: 412844.82476469607,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60d60&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2edeed720&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9646219744282969,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2b61bb370&gt;,
  &#39;iteration&#39;: 5,
  &#39;loglikelihood&#39;: 405718.57862391905,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea602b0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60250&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.1066673898750912,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60640&gt;,
  &#39;iteration&#39;: 6,
  &#39;loglikelihood&#39;: 415983.925941571,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60490&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60760&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0806318578055656,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61240&gt;,
  &#39;iteration&#39;: 7,
  &#39;loglikelihood&#39;: 416858.4161653833,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea614b0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea613c0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0102344432919617,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62380&gt;,
  &#39;iteration&#39;: 8,
  &#39;loglikelihood&#39;: 414257.0394215712,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62680&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61ab0&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0821152684078852,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62f20&gt;,
  &#39;iteration&#39;: 9,
  &#39;loglikelihood&#39;: 417764.7103005161,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62ec0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62d10&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0628439330942752,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60c70&gt;,
  &#39;iteration&#39;: 10,
  &#39;loglikelihood&#39;: 418085.83036392974,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91f9a0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60c40&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.01071378053145,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60550&gt;,
  &#39;iteration&#39;: 11,
  &#39;loglikelihood&#39;: 416671.5483449631,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91d060&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61bd0&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.06125861498167,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91d450&gt;,
  &#39;iteration&#39;: 12,
  &#39;loglikelihood&#39;: 418586.7202159421,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91d360&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91cd00&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.046438809261912,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62920&gt;,
  &#39;iteration&#39;: 13,
  &#39;loglikelihood&#39;: 418748.2154258507,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc8b0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea636a0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0064089218442853,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61720&gt;,
  &#39;iteration&#39;: 14,
  &#39;loglikelihood&#39;: 417929.9387790803,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bd1b0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60e80&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.044315278190893,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91fe50&gt;,
  &#39;iteration&#39;: 15,
  &#39;loglikelihood&#39;: 419053.901413677,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bff10&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91c850&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.032928348339306,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62860&gt;,
  &#39;iteration&#39;: 16,
  &#39;loglikelihood&#39;: 419142.6261917602,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9beb00&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea60460&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0022726458324056,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91c880&gt;,
  &#39;iteration&#39;: 17,
  &#39;loglikelihood&#39;: 418668.7303367079,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bfa90&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91c970&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0310819169451524,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62bf0&gt;,
  &#39;iteration&#39;: 18,
  &#39;loglikelihood&#39;: 419331.81249085104,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bde40&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea63c10&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.022400747988371,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62020&gt;,
  &#39;iteration&#39;: 19,
  &#39;loglikelihood&#39;: 419384.6657808487,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bd630&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61c00&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9990969032872745,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e91c910&gt;,
  &#39;iteration&#39;: 20,
  &#39;loglikelihood&#39;: 419117.17787774315,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bee60&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x2f3d14be0&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.020903831468017,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea63400&gt;,
  &#39;iteration&#39;: 21,
  &#39;loglikelihood&#39;: 419503.1781891738,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be200&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea62350&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0143336117743598,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea61a20&gt;,
  &#39;iteration&#39;: 22,
  &#39;loglikelihood&#39;: 419537.4338580138,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bd360&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42ea624a0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.996731360121657,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc520&gt;,
  &#39;iteration&#39;: 23,
  &#39;loglikelihood&#39;: 419391.0999065008,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be4d0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc670&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0131337570188672,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc190&gt;,
  &#39;iteration&#39;: 24,
  &#39;loglikelihood&#39;: 419612.81397406233,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc790&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc6d0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0081895689199645,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bfb50&gt;,
  &#39;iteration&#39;: 25,
  &#39;loglikelihood&#39;: 419636.6847504409,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bef20&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf2b0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9949613976847363,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be2c0&gt;,
  &#39;iteration&#39;: 26,
  &#39;loglikelihood&#39;: 419559.4179241776,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be320&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc2e0&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.007241126899907,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf730&gt;,
  &#39;iteration&#39;: 27,
  &#39;loglikelihood&#39;: 419685.6098920044,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e996fb0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bed10&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0035377514781483,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bd4b0&gt;,
  &#39;iteration&#39;: 28,
  &#39;loglikelihood&#39;: 419703.1797833361,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e996da0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be3b0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9936399908743172,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bda20&gt;,
  &#39;iteration&#39;: 29,
  &#39;loglikelihood&#39;: 419664.32482954196,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e997e80&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bcf10&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0028055191196619,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bffd0&gt;,
  &#39;iteration&#39;: 30,
  &#39;loglikelihood&#39;: 419487.46208422736,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e997460&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc160&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9799331479447816,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bc880&gt;,
  &#39;iteration&#39;: 31,
  &#39;loglikelihood&#39;: 418669.1558819624,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994880&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bcd00&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0211029605768254,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be0e0&gt;,
  &#39;iteration&#39;: 32,
  &#39;loglikelihood&#39;: 419634.10911400197,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9944f0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be260&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0136432733397405,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf460&gt;,
  &#39;iteration&#39;: 33,
  &#39;loglikelihood&#39;: 419659.03221757046,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994c40&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf850&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9943973775742112,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf5e0&gt;,
  &#39;iteration&#39;: 34,
  &#39;loglikelihood&#39;: 419411.490253184,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995870&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bd000&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.015325684269482,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bfeb0&gt;,
  &#39;iteration&#39;: 35,
  &#39;loglikelihood&#39;: 419725.5587795917,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e997520&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf220&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0099456346378402,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994cd0&gt;,
  &#39;iteration&#39;: 36,
  &#39;loglikelihood&#39;: 419738.1626685151,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e898400&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e996d10&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9957165764734817,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be800&gt;,
  &#39;iteration&#39;: 37,
  &#39;loglikelihood&#39;: 419626.3826360004,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89beb0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bf010&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.009612147376651,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995390&gt;,
  &#39;iteration&#39;: 38,
  &#39;loglikelihood&#39;: 419778.6108548996,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e8991b0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9973d0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0056281285483295,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994e50&gt;,
  &#39;iteration&#39;: 39,
  &#39;loglikelihood&#39;: 419787.8858903183,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e899360&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995f90&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9950185424057802,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9943a0&gt;,
  &#39;iteration&#39;: 40,
  &#39;loglikelihood&#39;: 419731.6003448446,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e898880&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e997340&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0050135239487987,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994820&gt;,
  &#39;iteration&#39;: 41,
  &#39;loglikelihood&#39;: 419813.53259433387,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e898a00&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995000&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.002046819706305,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995330&gt;,
  &#39;iteration&#39;: 42,
  &#39;loglikelihood&#39;: 419820.6780524987,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89bd30&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995cf0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9941334048497183,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9970a0&gt;,
  &#39;iteration&#39;: 43,
  &#39;loglikelihood&#39;: 419792.0089048097,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89a080&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994520&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.001496431493074,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e995f30&gt;,
  &#39;iteration&#39;: 44,
  &#39;loglikelihood&#39;: 419672.64219748904,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89a230&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994df0&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.9830572014967464,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9941c0&gt;,
  &#39;iteration&#39;: 45,
  &#39;loglikelihood&#39;: 419151.89420566417,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89bc10&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e994280&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0159118239103546,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9bfc40&gt;,
  &#39;iteration&#39;: 46,
  &#39;loglikelihood&#39;: 419768.8962983411,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89b250&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e9be980&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0099829791967136,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89b1c0&gt;,
  &#39;iteration&#39;: 47,
  &#39;loglikelihood&#39;: 419781.17991715414,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89ac20&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89aa10&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 0.994708877170725,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89a3e0&gt;,
  &#39;iteration&#39;: 48,
  &#39;loglikelihood&#39;: 419623.7705518758,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89a470&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89bfd0&gt;},
 {&#39;alpha&#39;: 1.0,
  &#39;background_normalization&#39;: 1.0112793627463252,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e8999c0&gt;,
  &#39;iteration&#39;: 49,
  &#39;loglikelihood&#39;: 419821.7835588583,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89a650&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89b400&gt;},
 {&#39;alpha&#39;: 5.0,
  &#39;background_normalization&#39;: 1.0070105323513425,
  &#39;delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e89ba90&gt;,
  &#39;iteration&#39;: 50,
  &#39;loglikelihood&#39;: 419827.8357267488,
  &#39;model_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e921db0&gt;,
  &#39;processed_delta_map&#39;: &lt;cosipy.image_deconvolution.modelmap.ModelMap object at 0x42e899030&gt;}]
</pre></div></div>
</div>
<p><strong>(If you want, you can save the results in the directory “./results” as follows)</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import os

os.mkdir(&quot;./results&quot;)

for result in all_results:
    iteration = result[&#39;iteration&#39;]
    result[&#39;model_map&#39;].write(f&#39;./results/model_map_itr{iteration}.hdf5&#39;)

    with open(f&#39;./results/result_itr{iteration}.txt&#39;, &#39;w&#39;) as f:
        paramlist = [&#39;alpha&#39;, &#39;loglikelihood&#39;, &#39;background_normalization&#39;]

        for param in paramlist:
            value = result[param]
            f.write(f&#39;{param}: {value}\n&#39;)
</pre></div>
</div>
</div>
</section>
</section>
<section id="5.-Analyze-the-results">
<h1>5. Analyze the results<a class="headerlink" href="#5.-Analyze-the-results" title="Link to this heading"></a></h1>
<p>Examples to see/analyze the results are shown below.</p>
<section id="Log-likelihood">
<h2>Log-likelihood<a class="headerlink" href="#Log-likelihood" title="Link to this heading"></a></h2>
<p>Plotting the log-likelihood vs the number of iterations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x, y = [], []

for result in all_results:
    x.append(result[&#39;iteration&#39;])
    y.append(result[&#39;loglikelihood&#39;])

plt.plot(x, y)
plt.grid()
plt.xlabel(&quot;iteration&quot;)
plt.ylabel(&quot;loglikelihood&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_52_0.png" src="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_52_0.png" />
</div>
</div>
</section>
<section id="Alpha-(the-factor-used-for-the-acceleration)">
<h2>Alpha (the factor used for the acceleration)<a class="headerlink" href="#Alpha-(the-factor-used-for-the-acceleration)" title="Link to this heading"></a></h2>
<p>Plotting <span class="math notranslate nohighlight">\(\alpha\)</span> vs the number of iterations. <span class="math notranslate nohighlight">\(\alpha\)</span> is a parameter to accelerate the EM algorithm (see the beginning of Section 4). If it is too large, reconstructed images may have artifacts.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x, y = [], []

for result in all_results:
    x.append(result[&#39;iteration&#39;])
    y.append(result[&#39;alpha&#39;])

plt.plot(x, y)
plt.grid()
plt.xlabel(&quot;iteration&quot;)
plt.ylabel(&quot;alpha&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_54_0.png" src="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_54_0.png" />
</div>
</div>
</section>
<section id="Background-normalization">
<h2>Background normalization<a class="headerlink" href="#Background-normalization" title="Link to this heading"></a></h2>
<p>Plotting the background nomalization factor vs the number of iterations. If the backgroud model is accurate and the image is reconstructed perfectly, this factor should be close to 1.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>x, y = [], []

for result in all_results:
    x.append(result[&#39;iteration&#39;])
    y.append(result[&#39;background_normalization&#39;])

plt.plot(x, y)
plt.grid()
plt.xlabel(&quot;iteration&quot;)
plt.ylabel(&quot;background_normalization&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_56_0.png" src="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_56_0.png" />
</div>
</div>
</section>
<section id="The-reconstructed-images">
<h2>The reconstructed images<a class="headerlink" href="#The-reconstructed-images" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def plot_reconstructed_image(result, source_position = None): # source_position should be (l,b) in degrees
    iteration = result[&#39;iteration&#39;]
    image = result[&#39;model_map&#39;]

    for energy_index in range(image.axes[&#39;Ei&#39;].nbins):
        map_healpxmap = HealpixMap(data = image[:,energy_index], unit = image.unit)

        _, ax = map_healpxmap.plot(&#39;mollview&#39;)

        _.colorbar.set_label(str(image.unit))

        if source_position is not None:
            ax.scatter(source_position[0]*u.deg, source_position[1]*u.deg, transform=ax.get_transform(&#39;world&#39;), color = &#39;red&#39;)

        plt.title(label = f&quot;iteration = {iteration}, energy_index = {energy_index} ({image.axes[&#39;Ei&#39;].bounds[energy_index][0]}-{image.axes[&#39;Ei&#39;].bounds[energy_index][1]})&quot;)
</pre></div>
</div>
</div>
<p>Plotting the reconstructed images in all of the energy bands at the 50th iteration</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>iteration = 49

plot_reconstructed_image(all_results[iteration])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_60_0.png" src="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_60_0.png" />
</div>
</div>
<p>An example to plot the image in the log scale</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>iteration_idx = 49

result = all_results[iteration_idx]

iteration = result[&#39;iteration&#39;]
image = result[&#39;model_map&#39;]

data = image[:,0]
data[data &lt;= 0 * data.unit] = 1e-12 * data.unit

hp.mollview(data, min = 1e-5, norm =&#39;log&#39;, unit = str(data.unit), title = f&#39;511 keV image at {iteration}th iteration&#39;, cmap = &#39;magma&#39;)

plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_62_0.png" src="../../../../_images/tutorials_image_deconvolution_511keV_GalacticCDS_511keV-DC2-Galactic-ImageDeconvolution_62_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, COSI Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>